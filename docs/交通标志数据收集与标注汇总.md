# 交通标志数据收集与标注汇总
**更新日期**：2025.12.20

**在线展示**：https://92d97fa6.pinit.eth.limo/

---

## 一、数据采集概览

### 视频数据统计

| 来源 | 数量 | 时长 | 分辨率 |
|------|------|------|--------|
| D1-D6, N6-N8 | 9 个 | 83.7 分钟 | 1080p |
| DJI 4K | 17 个 | 399.3 分钟 | 4K |
| **总计** | **26 个** | **483 分钟 (8 小时)** | - |

### 地理覆盖

| 统计项 | 数据 |
|--------|------|
| 骑行路线数 | 14 条 |
| 总里程 | 216.37 公里 |

#### 覆盖区域

| 区域 | 说明 |
|------|------|
| Hong Kong Island (香港岛) | 港岛北部、南部道路 |
| Kowloon (九龙) | 九龙半岛主要道路 |
| Tuen Mun (屯门) | 新界西部 |
| Sha Tin (沙田) | 新界中部 |
| Lantao Island (大屿山) | 机场、东涌一带 |

#### 道路类型
- 城市主干道
- 高速公路（如吐露港公路、屯门公路）
- 郊区道路

### 场景覆盖

| 场景 | 视频数 | 时长 | 占比 |
|------|--------|------|------|
| 白天 | 19 个 | 347 分钟 | 73% |
| 夜晚 | 7 个 | 126 分钟 | 27% |

- 天气：晴天/阴天为主
- 拍摄时间跨度：2025年4月 - 7月

---

## 二、标注数据统计

### 已提取交通标志图片

| 来源 | 数量 | 格式 |
|------|------|------|
| 1080p 视频 (D1-N8) | 8,680 张 | JPG |
| 4K 视频 (DJI) | 3,331 张 | PNG (无损) |
| **总计** | **12,011 张** | - |

### VLM 自动标注结果

| 统计项 | 数据 |
|--------|------|
| 标注文件总数 | 15,424 个 |
| 粗粒度标注类别 | vehicle, pedestrian, traffic_sign, construction |
| 细粒度标注 (traffic_sign) | 部分已有，约 20+ 种类别 |

#### 细粒度标签分布 (Top 15)

| 标签 | 数量 |
|------|------|
| 100m_Countdown_markers | 2,613 |
| traffic_sign (未细分) | 1,277 |
| Direction_sign | 467 |
| 200m_Countdown_markers | 449 |
| Traffic_lights_ahead | 303 |
| Bend_to_left_ahead | 247 |
| 300m_Countdown_markers | 190 |
| No_entry_for_all_vehicles | 142 |
| Ahead_only | 102 |
| Bus_lane_for_franchised_buses_only | 83 |
| No_motor_vehicles | 69 |
| Temporary_closure_of_lane_or_road | 50 |
| Direction_to_MTR_Station | 41 |
| Speed_limit_80_km_h | 39 |
| Street_direction_sign | 38 |

### 标签类别

- 目标类别：**188 种**香港标准交通标志
- 参考图来源：`raw_data/signs/` (188 张 PNG 标准图)

---

## 三、技术路线

### 整体流程

```
原始视频 (26段, 8小时)
        ↓
   [视频切分] 按场景切分为片段
        ↓
   [帧提取] 3 FPS 提取关键帧
        ↓
   [VLM 检测] GLM-4.6V 目标检测
        ↓
   [标志裁剪] 根据 bbox 裁剪交通标志
        ↓
   [人工筛选] 过滤无效图片
        ↓
   [人工标注] 匹配 188 种标准标志
        ↓
   [模型微调] 训练分类头
        ↓
   [自动标注] 批量处理剩余数据
```

### 检测与裁剪

| 模块 | 技术方案 |
|------|----------|
| 目标检测 | GLM-4.6V (VLM) |
| 图片缩放 | 4K → 2048px (检测用)，坐标映射回原图 |
| 裁剪方式 | PIL `Image.crop()` 矩形裁剪 |
| 保存格式 | PNG 无损 / JPEG (quality=100) |

### 标注工具

#### 1. 筛选 UI (`sign_filter_ui.py`)
- **演示**：[查看界面演示](https://92d97fa6.pinit.eth.limo/tools/filter_ui.html)
- **本地运行**：`python scripts/sign_filter_ui.py` → http://localhost:8081
- **功能**：快速过滤图片，分类为 Valid / Unclear / Not Sign
- **快捷键**：`1/V` Valid, `2/U` Unclear, `3/N` Not Sign, `Z` 撤销
- **输出**：`extracted_signs/filter_results.json`

#### 2. 标注 UI (`sign_labeling_ui.py`)
- **演示**：[查看界面演示](https://92d97fa6.pinit.eth.limo/tools/labeling_ui.html)
- **本地运行**：`python scripts/sign_labeling_ui.py` → http://localhost:8082
- **功能**：对照 188 种参考图进行细粒度标注
- **特性**：支持搜索、快捷键操作
- **输出**：`extracted_signs/label_results.json`

### 分类模型方案

| 方案 | 说明 | 状态 |
|------|------|------|
| VLM 直接推理 | GLM-4.6V 直接输出细粒度标签 | 准确率有限 |
| RAG 检索 | CLIP/DINOv2 + 向量检索 + VLM 精排 | 测试中 |
| 分类头微调 | ResNet50 + 人工标注数据 | 待训练 |

---

## 四、处理效率统计

### 4K 视频处理效率

| 视频 | 片段数 | 视频时长 | 文件大小 | 抠图数 | 处理耗时 |
|------|--------|----------|----------|--------|----------|
| DJI_0004 | 15 | 8.3 分钟 | 3.2 GB | 453 张 | 0.95 小时 |
| DJI_0013 | 57 | 31.6 分钟 | 16 GB | 1,380 张 | 4.28 小时 |
| DJI_0014 | 11 | 6.1 分钟 | 3.1 GB | 243 张 | 0.65 小时 |
| DJI_0015 | 57 | 31.3 分钟 | 16 GB | 1,255 张 | 3.72 小时 |
| **总计** | **140** | **77.3 分钟** | **38.3 GB** | **3,331 张** | **9.6 小时** |

- **平均处理效率**：1 分钟视频 ≈ 7.5 分钟处理时间
- **4 个视频并行处理**，实际墙钟时间约 5.3 小时

### 人工标注预估

| 阶段 | 数量 | 预计耗时 |
|------|------|----------|
| 筛选 | 3,331 张 | 1.5 小时 |
| 标注 | ~1,200 张 (valid) | 5 小时 |
| **总计** | - | **6-7 小时** |

---

## 五、待处理任务

- [ ] 完成 3,331 张 4K 图片筛选
- [ ] 完成首批 500+ 张细粒度标注
- [ ] 训练 ResNet50 分类头
- [ ] 处理剩余 13 个 DJI 4K 视频 (约 322 分钟)
- [ ] 评估 RAG vs 微调分类头效果

---

## 六、文件结构

```
GLM_Labeling/
├── raw_data/
│   ├── videos/
│   │   ├── raw_videos/      # 1080p 原始视频 (D1-N8)
│   │   └── clips/           # 切分后的视频片段
│   └── signs/               # 188 种标准交通标志参考图
├── extracted_signs/
│   ├── D1/ - N8/            # 1080p 提取的标志 (8,680 张)
│   ├── DJI/                 # 4K 提取的标志 (3,331 张)
│   ├── filter_results.json  # 筛选结果
│   └── label_results.json   # 标注结果
├── dataset_output/          # VLM 自动标注结果 (15,424 帧)
├── scripts/
│   ├── sign_filter_ui.py    # 筛选工具
│   ├── sign_labeling_ui.py  # 标注工具
│   └── extract_traffic_signs.py  # 标志提取脚本
└── docs/
    └── 交通标志数据收集与标注汇总.md  # 本文档
```
